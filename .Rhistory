fig2 <- plot_ly(
type = 'scatter',
x = breIng.annioCalifcup$year,
y = -1*breIng.annioEdadFte$Profesional,
mode = "lines",
line = list(shape = "spline")
) %>%
layout(
title = "Brecha Salarial en CABA",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,25))
)
fig2
fig2 <- plot_ly(
type = 'scatter',
x = breIng.annioCalifcup$year,
y = breIng.annioEdadFte$Profesional,
mode = "lines",
line = list(shape = "spline")
) %>%
layout(
title = "Brecha Salarial en CABA",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,25))
)
fig2
fig2 <- plot_ly(
type = 'scatter',
x = breIng.annioCalifcup$year,
y = breIng.annioEdadFte$Profesional,
mode = "lines",
line = list(shape = "spline")
) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,25))
)
fig2 <- plot_ly(
type = 'scatter',
x = breIng.annioCalifcup$year,
y = breIng.annioEdadFte$Profesional,
mode = "lines",
line = list(shape = "spline")
) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,25))
)
fig2 <- plot_ly(
type = 'scatter',
x = breIng.annioCalifcup$year,
y = -breIng.annioCalifcup$Profesional,
mode = "lines",
line = list(shape = "spline")
) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,25))
)
fig2
fig2 <- plot_ly(
type = 'scatter',
x = breIng.annioCalifcup$year,
y = -breIng.annioCalifcup$Profesional,
mode = "lines",
line = list(shape = "spline")
) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,35))
)
fig2
fig2 <- plot_ly(breIng.annioCalifcup,
type = 'scatter',
x = ~year,
mode = "lines",
line = list(shape = "spline")) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,35))
) %>%
add_lines(y = -Profesional, name = "Profesional", line = list(shape = "spline"))%>%
add_lines(y = -Tecnico, name = "Tecnico", line = list(shape = "spline"))%>%
add_lines(y = -Operativo, name = "Operativo", line = list(shape = "spline"))%>%
add_lines(y = -'No calificado', name = "No calificado", line = list(shape = "spline"))
fig2 <- plot_ly(breIng.annioCalifcup,
type = 'scatter',
x = ~year,
mode = "lines",
line = list(shape = "spline")) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,35))
) %>%
add_lines(y = -breIng.annioCalifcup$Profesional, name = "Profesional", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$Tecnico, name = "Tecnico", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$Operativo, name = "Operativo", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$'No calificado', name = "No calificado", line = list(shape = "spline"))
fig2 <- plot_ly(breIng.annioCalifcup,
type = 'scatter',
x = ~year,
mode = "lines",
line = list(shape = "spline")) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,35))
) %>%
add_lines(y = breIng.annioCalifcup$Profesional, name = "Profesional", line = list(shape = "spline"))%>%
add_lines(y = breIng.annioCalifcup$Tecnico, name = "Tecnico", line = list(shape = "spline"))%>%
add_lines(y = breIng.annioCalifcup$Operativo, name = "Operativo", line = list(shape = "spline"))%>%
add_lines(y = breIng.annioCalifcup$'No calificado', name = "No calificado", line = list(shape = "spline"))
fig2
colnames(breIng.annioCalifcup)
breIng.annioCalifcup <- rename(pivot_wider(breIng.annioCalifcup,
names_from= calificacion_ocupacional,
values_from = brecha_ing),
year = anio, profesiona= Profesional, tecnico = 'Técnico', operativo = Operativo, noCalif = "No calificado")
### Datasets
breIng.annioEdadFte <- read_csv("trabajo/bre_ing_perc_annio__g_edad__fte_ingr_limpio.csv",
locale = locale(decimal_mark = ","))
breIng.annioCalifcup <- read_csv("trabajo/bre_ing_prom_annio__calif_ocup_limpio.csv")
breIng.annioRubro <- read_csv("trabajo/bre_ing_rama_rama__annio_limpio.csv",
locale = locale(decimal_mark = ","))
breOcup.annio <- read_csv("trabajo/bre_ocup_ppal_annio_limpio.csv")
breOcup.annioSexCargo <- read_csv("trabajo/jer_ocup_epf_sexo__annio__jer_ocup_limpio.csv")
breOcup.annioPorcentCargo <- read_csv("trabajo/cargos_supemp_annio__cargo_limpio.csv")
### Preparacion
breIng.annioEdadFte <- rename(select(filter(pivot_wider(breIng.annioEdadFte,
names_from= fuente_ingresos,
values_from= brecha_ing),
grupo_edad == "10 – 64"),
c(anio, Laboral)),
year = anio, brechaGral = Laboral)
breIng.annioCalifcup <- rename(pivot_wider(breIng.annioCalifcup,
names_from= calificacion_ocupacional,
values_from = brecha_ing),
year = anio, profesiona= Profesional, tecnico = 'Técnico', operativo = Operativo, noCalif = "No calificado")
breIng.annioRubro <- rename(pivot_wider(filter(breIng.annioRubro,
rama != "TOTAL"),
names_from= rama,
values_from = brecha_ing),
year = anio)
### Visualizaciones
fig <- plot_ly(
type = 'scatter',
x = breIng.annioEdadFte$year,
y = -breIng.annioEdadFte$brechaGral,
mode = "lines",
line = list(shape = "spline")
) %>%
layout(
title = "Brecha Salarial en CABA",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,25))
)
fig2 <- plot_ly(breIng.annioCalifcup,
type = 'scatter',
x = ~year,
mode = "lines",
line = list(shape = "spline")) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,35))
) %>%
add_lines(y = -profesional, name = "Profesional", line = list(shape = "spline"))%>%
add_lines(y = -tecnico, name = "Tecnico", line = list(shape = "spline"))%>%
add_lines(y = -operativo, name = "Operativo", line = list(shape = "spline"))%>%
add_lines(y = -noCalif, name = "No calificado", line = list(shape = "spline"))
fig2 <- plot_ly(breIng.annioCalifcup,
type = 'scatter',
x = ~year,
mode = "lines",
line = list(shape = "spline")) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,35))
) %>%
add_lines(y = -breIng.annioCalifcup$profesional, name = "Profesional", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$tecnico, name = "Tecnico", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$operativo, name = "Operativo", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$noCalif, name = "No calificado", line = list(shape = "spline"))
fig2
breIng.annioCalifcup <- read_csv("trabajo/bre_ing_prom_annio__calif_ocup_limpio.csv")
breIng.annioCalifcup <- rename(pivot_wider(breIng.annioCalifcup,
names_from= calificacion_ocupacional,
values_from = brecha_ing),
year = anio, profesional= Profesional, tecnico = 'Técnico', operativo = Operativo, noCalif = "No calificado")
fig2 <- plot_ly(breIng.annioCalifcup,
type = 'scatter',
x = ~year,
mode = "lines",
line = list(shape = "spline")) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,35))
) %>%
add_lines(y = -breIng.annioCalifcup$profesional, name = "Profesional", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$tecnico, name = "Tecnico", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$operativo, name = "Operativo", line = list(shape = "spline"))%>%
add_lines(y = -breIng.annioCalifcup$noCalif, name = "No calificado", line = list(shape = "spline"))
fig2
fig2 <- plot_ly(breIng.annioCalifcup,
type = 'scatter',
x = ~year,
mode = "lines"
) %>%
layout(
title = "Brecha Salarial en CABA por Calif",
xaxis = list(title = 'Año'),
yaxis = list (title = 'Porcentaje',
range=c(10,35))
) %>%
add_lines(y = -breIng.annioCalifcup$profesional, name = "Profesional"
) %>%
add_lines(y = -breIng.annioCalifcup$tecnico, name = "Tecnico"
) %>%
add_lines(y = -breIng.annioCalifcup$operativo, name = "Operativo"
) %>%
add_lines(y = -breIng.annioCalifcup$noCalif, name = "No calificado")
fig2
# figura global de confirmados
# 2020-03-15  version actual:   2020-04-24
# GAD
###############################################
options(allow_html=TRUE)
# Bibliotecas a importar
check_packages <- function(packages) {
if (all(packages %in% rownames(installed.packages()))) {
TRUE
} else{
cat(
"Instalar los siguientes packages antes de ejecutar el presente script\n",
packages[!(packages %in% rownames(installed.packages()))],
"\n"
)
}
}
packages_needed <- c("ggplot2", "ggrepel", "plotly",
"lubridate", "htmlwidgets" , "RColorBrewer",
"sqldf", "grid", "data.table", "readr" )
check_packages(packages_needed)
library(ggplot2)
library(ggrepel)
library(plotly)
library(lubridate)
library(htmlwidgets)
library(RColorBrewer)
library(sqldf)
library(grid)
library(data.table)
library(readr)
install.packages("ggrepel")
install.packages("sqldf")
options(allow_html=TRUE)
# Bibliotecas a importar
check_packages <- function(packages) {
if (all(packages %in% rownames(installed.packages()))) {
TRUE
} else{
cat(
"Instalar los siguientes packages antes de ejecutar el presente script\n",
packages[!(packages %in% rownames(installed.packages()))],
"\n"
)
}
}
packages_needed <- c("ggplot2", "ggrepel", "plotly",
"lubridate", "htmlwidgets" , "RColorBrewer",
"sqldf", "grid", "data.table", "readr" )
check_packages(packages_needed)
library(ggplot2)
library(ggrepel)
library(plotly)
library(lubridate)
library(htmlwidgets)
library(RColorBrewer)
library(sqldf)
library(grid)
library(data.table)
library(readr)
URL <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/"
url_archivo  <- paste(URL,"time_series_covid19_confirmed_global.csv", sep = "")
COVID_19_h  <- read.csv(url_archivo, sep = ",", header = T)
COVID_19_h$Lat  <- NULL
COVID_19_h$Long <- NULL
COVID_19_h$Province.State <- NULL
colnames(COVID_19_h)
library(tidyr)
COVID_19  <- COVID_19_h %>% gather(date, casos, 2:ncol(COVID_19_h))
colnames(COVID_19) <- c(  "pais", "date", "casos")
COVID_19$date <- as.Date(as.character(COVID_19$date), format = "X%m.%d.%y")
casos_por_fecha <- COVID_19 %>% group_by(date) %>% summarise(casos = sum(casos))
# -- ordenamos
#library(tidyverse)
datos <- arrange(casos_por_fecha, (casos_por_fecha$date) )
g1 <- ggplot(datos ,aes(x = date, y = casos)) +
geom_point( size=1, color="blue") +
ggtitle("COVID_19 - Casos confirmados a nivel mundial") +
scale_x_date(date_breaks = "4 day", date_labels =  "%d %b") +
#scale_y_continuous(limits = c(0, 100), breaks = seq(1, 5, 1)) +
theme(plot.title = element_text(lineheight = 1,face ='bold'))   +
ylab("cantidad de casos") +
xlab("") +
labs(caption = "\nFuente: The Johns Hopkins University Center for Systems Science and Engineering (JHU CSSE)") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
g1 <- ggplotly(g1, tooltip = c("casos")) %>%
layout(legend = list(
orientation = "h",
x = 0.7,
y = 1
)
)
g1
# Bibliotecas a importar
check_packages <- function(packages) {
if (all(packages %in% rownames(installed.packages()))) {
TRUE
} else{
cat(
"Instalar los siguientes packages antes de ejecutar el presente script\n",
packages[!(packages %in% rownames(installed.packages()))],
"\n"
)
}
}
packages_needed <- c("ggplot2", "ggrepel", "plotly", "sqldf",
"lubridate", "htmlwidgets" , "RColorBrewer",
"grid", "data.table", "readr" )
check_packages(packages_needed)
library(ggplot2)
library(ggrepel)
library(plotly)
library(sqldf)
library(lubridate)
library(htmlwidgets)
library(RColorBrewer)
library(grid)
library(data.table)
URL          <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/"
url_archivo  <- paste(URL,"time_series_covid19_confirmed_global.csv", sep = "")
COVID_19_h   <- read.csv(url_archivo, sep = ",", header = T)
COVID_19_h$Long <- NULL
COVID_19_h$Province.State <- NULL
colnames(COVID_19_h)
library(tidyr)
################################### preparo los datos
COVID_19_h$Lat  <- NULL
setnames(COVID_19_h ,
old = c( "Country.Region" ),
new = c( "pais"))
COVID_19 <- COVID_19_h %>% gather(fecha, casos, 2:ncol(COVID_19_h))
COVID_19$fecha <- as.Date(as.character(COVID_19$fecha), format = "X%m.%d.%y")
COVID_19       <- COVID_19 %>% group_by(pais,fecha) %>% summarise(casos = sum(casos))
# el siguiente agrupamiento es para quedarde con el max de la variable acumulativa
casos_por_pais <- COVID_19 %>% group_by(pais) %>% summarise(casos = max(casos))
#   normalizo nombres de paises para compatibilidad de archivo habitantes
library(tidyverse)
library(dplyr)
casos_por_pais <- casos_por_pais %>%
mutate(pais = str_replace(pais,  "Korea\\, South"      , "South Korea")) %>%
mutate(pais = str_replace(pais,  "Congo \\(Kinshasa\\)", "Democratic Republic of the Congo"))%>%
mutate(pais = str_replace(pais,  "Taiwan\\*"           , "Taiwan")) %>%
mutate(pais = str_replace(pais,  "US"                  , "United States of America")) %>%
mutate(pais = str_replace(pais,  "Brunei"              , "Brunei Darussalam"))%>%
mutate(pais = str_replace(pais,  "Cote d'Ivoire"       , "Costa de Marfil"))%>%
mutate(pais = str_replace(pais,  "Holy See"            , "Vatican City"))%>%
mutate(pais = str_replace(pais,  "Czechia"             , "Czech Republic"))%>%
mutate(pais = str_replace(pais,  "Diamond Princess"    , "crucero Diamond Princess"))%>%
mutate(pais = str_replace(pais,  "MS Zaandam"          , "crucero MS Zaandam"))%>%
mutate(pais = str_replace(pais,  "Timor-Leste"         , "East Timor"))
habitantes <- read_delim("C:\Users\ignag\Downloads\WPP2019_POP_F01_1_TOTAL_POPULATION_BOTH_SEXES.csv",
";", escape_double = FALSE, col_types = cols(cantidad = col_number()),
locale = locale(grouping_mark = "", encoding = "WINDOWS-1252"),
trim_ws = TRUE)
habitantes <- read_delim("C:/Users/ignag/Downloads/WPP2019_POP_F01_1_TOTAL_POPULATION_BOTH_SEXES.csv",
";", escape_double = FALSE, col_types = cols(cantidad = col_number()),
locale = locale(grouping_mark = "", encoding = "WINDOWS-1252"),
trim_ws = TRUE)
#############################################   preparo los datos de poblaciones
colnames(habitantes)
habitantes <- select(habitantes, pais, codigo , cantidad )
setnames(habitantes, "cantidad", "cantHabitantes")
datos <- merge(habitantes, casos_por_pais)
# -- creo variable nueva con la tasa por cada 100.000 habitantes
options(scipen = 6) #para evitar notacion cientifica
datos$porMil <- datos$casos * 1000 / datos$cantHabitantes
#--------------------------------------------- aqui trabajo  con SQL
no_estan <- sqldf("select c.pais
from casos_por_pais c
where not exists (select '1'
from datos d
where c.pais = d.pais)")
no_estan
# -- ordenamos
datos <- arrange(datos, desc(datos$porMil) )
#######
#   grabar los datos en un archivo .csv
write.csv2(datos, "datos_01.csv",  row.names = FALSE, fileEncoding = "UTF-8")
# para graficar los mas importantes
datos <- sqldf( "select *
from datos
LIMIT 25 ")
g1 <- ggplot(datos ,aes(x = reorder(pais, porMil) , y = porMil, label = casos ) ) +
geom_segment(size = 0.08, aes(xend = pais, yend=0)) +
coord_flip() +    # para girar el  grafico
geom_point( size=2, color="orange") +
ggtitle("COVID_19 - Confirmados por cada 1.000 habitantes") +
theme(plot.title = element_text(lineheight = 1,face ='bold'))   +
ylab("confirmados por cada 1.000 habitantes") +
xlab("") +
labs(caption = "\nFuente: The Johns Hopkins University Center for Systems Science and Engineering (JHU CSSE)") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
geom_text(aes(label = round(porMil,1)), position = position_stack(vjust = .5))
g1 <- ggplotly(g1, tooltip = c("casos")) %>%
layout(legend = list(
orientation = "h",
x = 0.7,
y = 0
)
)
g1
# para graficar los mas importantes
datos <- sqldf( "select *
from datos
LIMIT 50 ")
g1 <- ggplot(datos ,aes(x = reorder(pais, porMil) , y = porMil, label = casos ) ) +
geom_segment(size = 0.08, aes(xend = pais, yend=0)) +
coord_flip() +    # para girar el  grafico
geom_point( size=2, color="orange") +
ggtitle("COVID_19 - Confirmados por cada 1.000 habitantes") +
theme(plot.title = element_text(lineheight = 1,face ='bold'))   +
ylab("confirmados por cada 1.000 habitantes") +
xlab("") +
labs(caption = "\nFuente: The Johns Hopkins University Center for Systems Science and Engineering (JHU CSSE)") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
geom_text(aes(label = round(porMil,1)), position = position_stack(vjust = .5))
g1 <- ggplotly(g1, tooltip = c("casos")) %>%
layout(legend = list(
orientation = "h",
x = 0.7,
y = 0
)
)
g1
habitantes <- select(habitantes, pais, codigo , cantidad )
setnames(habitantes, "cantidad", "cantHabitantes")
datos <- merge(habitantes, casos_por_pais)
# -- creo variable nueva con la tasa por cada 100.000 habitantes
options(scipen = 6) #para evitar notacion cientifica
datos$porMil <- datos$casos * 1000 / datos$cantHabitantes
#--------------------------------------------- aqui trabajo  con SQL
no_estan <- sqldf("select c.pais
from casos_por_pais c
where not exists (select '1'
from datos d
where c.pais = d.pais)")
no_estan
# -- ordenamos
datos <- arrange(datos, desc(datos$porMil) )
#######
#   grabar los datos en un archivo .csv
write.csv2(datos, "datos_01.csv",  row.names = FALSE, fileEncoding = "UTF-8")
# para graficar los mas importantes
datos <- sqldf( "select *
from datos
LIMIT 50 ")
g1 <- ggplot(datos ,aes(x = reorder(pais, porMil) , y = porMil, label = casos ) ) +
geom_segment(size = 0.08, aes(xend = pais, yend=0)) +
coord_flip() +    # para girar el  grafico
geom_point( size=2, color="orange") +
ggtitle("COVID_19 - Confirmados por cada 1.000 habitantes") +
theme(plot.title = element_text(lineheight = 1,face ='bold'))   +
ylab("confirmados por cada 1.000 habitantes") +
xlab("") +
labs(caption = "\nFuente: The Johns Hopkins University Center for Systems Science and Engineering (JHU CSSE)") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
geom_text(aes(label = round(porMil,1)), position = position_stack(vjust = .5))
g1 <- ggplotly(g1, tooltip = c("casos")) %>%
layout(legend = list(
orientation = "h",
x = 0.7,
y = 0
)
)
g1
